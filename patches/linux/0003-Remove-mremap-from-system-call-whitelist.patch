From f74604df3722013f766df3b4c84ae6d9f4a213a8 Mon Sep 17 00:00:00 2001
From: qua3k <qua3kr@gmail.com>
Date: Fri, 19 Nov 2021 00:00:00 +0000
Subject: [PATCH] Remove mremap from system call whitelist

It's not used in PartitionAlloc and should be removed.
---
 sandbox/policy/linux/bpf_cdm_policy_linux.cc              | 1 -
 sandbox/policy/linux/bpf_print_compositor_policy_linux.cc | 1 -
 sandbox/policy/linux/bpf_renderer_policy_linux.cc         | 1 -
 sandbox/policy/linux/bpf_service_policy_linux.cc          | 1 -
 sandbox/policy/linux/bpf_utility_policy_linux.cc          | 1 -
 5 files changed, 5 deletions(-)

diff --git a/sandbox/policy/linux/bpf_cdm_policy_linux.cc b/sandbox/policy/linux/bpf_cdm_policy_linux.cc
index fdd7aaa266f11..27ee68dc19de6 100644
--- a/sandbox/policy/linux/bpf_cdm_policy_linux.cc
+++ b/sandbox/policy/linux/bpf_cdm_policy_linux.cc
@@ -39,7 +39,6 @@ ResultExpr CdmProcessPolicy::EvaluateSyscall(int sysno) const {
 #if defined(__i386__) || defined(__arm__)
     case __NR_ugetrlimit:
 #endif
-    case __NR_mremap:  // https://crbug.com/546204
     case __NR_pwrite64:
     case __NR_sysinfo:
     case __NR_times:
diff --git a/sandbox/policy/linux/bpf_print_compositor_policy_linux.cc b/sandbox/policy/linux/bpf_print_compositor_policy_linux.cc
index bff338a903e58..007e1ecc76760 100644
--- a/sandbox/policy/linux/bpf_print_compositor_policy_linux.cc
+++ b/sandbox/policy/linux/bpf_print_compositor_policy_linux.cc
@@ -39,7 +39,6 @@ ResultExpr PrintCompositorProcessPolicy::EvaluateSyscall(int sysno) const {
 #if defined(__i386__) || defined(__arm__)
     case __NR_ugetrlimit:
 #endif
-    case __NR_mremap:  // https://crbug.com/546204
     case __NR_pwrite64:
     case __NR_sysinfo:
     case __NR_times:
diff --git a/sandbox/policy/linux/bpf_renderer_policy_linux.cc b/sandbox/policy/linux/bpf_renderer_policy_linux.cc
index f5e044fecad64..64b0eb81295d2 100644
--- a/sandbox/policy/linux/bpf_renderer_policy_linux.cc
+++ b/sandbox/policy/linux/bpf_renderer_policy_linux.cc
@@ -109,7 +109,6 @@ ResultExpr RendererProcessPolicy::EvaluateSyscall(int sysno) const {
 #if defined(__i386__) || defined(__arm__)
     case __NR_ugetrlimit:
 #endif
-    case __NR_mremap:  // See crbug.com/149834.
     case __NR_pwrite64:
     case __NR_sched_get_priority_max:
     case __NR_sched_get_priority_min:
diff --git a/sandbox/policy/linux/bpf_service_policy_linux.cc b/sandbox/policy/linux/bpf_service_policy_linux.cc
index 0ca7b7a67f88b..2f7ab41d9fd2a 100644
--- a/sandbox/policy/linux/bpf_service_policy_linux.cc
+++ b/sandbox/policy/linux/bpf_service_policy_linux.cc
@@ -57,7 +57,6 @@ ResultExpr ServiceProcessPolicy::EvaluateSyscall(int sysno) const {
 #if defined(__i386__) || defined(__arm__)
     case __NR_ugetrlimit:
 #endif
-    case __NR_mremap:  // https://crbug.com/546204
     case __NR_pwrite64:
     case __NR_times:
       return Allow();
diff --git a/sandbox/policy/linux/bpf_utility_policy_linux.cc b/sandbox/policy/linux/bpf_utility_policy_linux.cc
index f36007c5a3503..ed7ede9ea184b 100644
--- a/sandbox/policy/linux/bpf_utility_policy_linux.cc
+++ b/sandbox/policy/linux/bpf_utility_policy_linux.cc
@@ -44,7 +44,6 @@ ResultExpr UtilityProcessPolicy::EvaluateSyscall(int sysno) const {
 #if defined(__i386__) || defined(__arm__)
     case __NR_ugetrlimit:
 #endif
-    case __NR_mremap:  // https://crbug.com/546204
     case __NR_pwrite64:
     case __NR_sysinfo:
     case __NR_times:
